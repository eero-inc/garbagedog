#!/usr/bin/env python

import argparse

from garbagedog import parse_and_emit_stats

parser = argparse.ArgumentParser(description='Send GC stats over dogstatsd',
                                 usage="garbagedog --log-dir /var/log/eero/")

parser.add_argument('--tags',
                    help='Extra datadog tags, comma separated; ie "application:actorcluster, version:2017.07.27"')

parser.add_argument('--dogstatsd-host',
                    help='dogstatsd host (default=localhost)', default='localhost')
parser.add_argument('--dogstatsd-port', type=int,
                    help='dogstatsd port (default=8125)', default=8125)
parser.add_argument('--verbose', action='store_true',
                    help='Emit noisy messages on stdout')
parser.add_argument('--log-dir',
                    help='Read from this log dir instead of stdin')

args = parser.parse_args()

parsed_tags = []
if args.tags:
    parsed_tags = args.tags.replace(' ', '').split(',')

if args.log_dir:
    parse_and_emit_stats.from_log_dir(args.log_dir, args.dogstatsd_host, args.dogstatsd_port, parsed_tags, args.verbose)
else:
    parse_and_emit_stats.from_stdin(args.dogstatsd_host, args.dogstatsd_port, parsed_tags, args.verbose)
